# Runbook: CVE Triage Process

**Owner**: Platform Engineering Team
**Frequency**: Daily review
**Last Updated**: 2026-02-21

---

## 1. Daily Triage Process

### Schedule
Every business day at 09:00 local time (15 minutes allocated).

### Data Sources
1. **Harbor Trivy scans**: Automatic scans on every image push. Results available in Harbor UI and API.
2. **NVD/CVE feeds**: Subscribe to Ubuntu USN, Node.js security, JDK advisories, .NET security updates.
3. **Falco alerts**: Runtime detections that may indicate active exploitation.

### Steps
1. Open Harbor vulnerability dashboard: `https://harbor.internal/harbor/projects/aibox/repositories`
2. Review new vulnerabilities since last triage (filter by "New" status).
3. For each new CVE:
   a. Check CVSS score and severity.
   b. Check if the vulnerable component is reachable in our images.
   c. Determine if a fix is available.
   d. Classify response per severity table below.
4. Update triage log in `#aibox-platform` Slack channel.

---

## 2. Severity Classification and Response

| Severity | CVSS | Response SLA | Action | Owner |
|----------|------|-------------|--------|-------|
| Critical | 9.0+ | 4 hours | Emergency rebuild + mandatory update | On-call engineer |
| High | 7.0-8.9 | Same business day | Emergency rebuild + mandatory update | On-call engineer |
| Medium | 4.0-6.9 | Next weekly rebuild | Batch into weekly cycle | Triage owner |
| Low | 0.1-3.9 | Next weekly rebuild | Batch into weekly cycle | Triage owner |
| Informational | 0.0 | Monthly review | Assess and document | Triage owner |

---

## 3. Critical/High CVE Emergency Response

### Step 1: Assess Impact
- Which image variants are affected?
- Is the vulnerable component in the runtime path or only build-time?
- Is there a known exploit in the wild?

### Step 2: Emergency Rebuild
```bash
# Trigger emergency CI build with targeted fix
./ci/emergency-rebuild.sh --cve CVE-XXXX-XXXXX --variant base,java,node,dotnet,full

# The script:
# 1. Patches the specific package
# 2. Rebuilds affected variants
# 3. Runs Trivy scan to confirm fix
# 4. Signs with Cosign
# 5. Pushes to Harbor with cve-tagged version
```

### Step 3: Enforce Mandatory Update
For CVSS 9+ vulnerabilities:
```bash
# Set mandatory update flag
aibox-admin image set-mandatory --min-date $(date +%Y-%m-%d) --cve CVE-XXXX-XXXXX
```

### Step 4: Notify
Post to `#aibox-announce`:
```
SECURITY UPDATE: Critical CVE (CVE-XXXX-XXXXX) patched in AI-Box images.
Affected: [list affected variants]
Action required: Run 'aibox update' immediately.
Mandatory enforcement: Sandboxes with images older than [date] will not start.
```

### Step 5: Verify Adoption
After 24 hours, check fleet image distribution:
```bash
# Query adoption of patched image
aibox-admin fleet image-versions --format table
```

If > 10% of active developers have not updated after 24 hours, send a direct reminder.

---

## 4. Zero-Day Vulnerability Response

### Definition
A zero-day is a vulnerability that is being actively exploited before a vendor patch is available.

### Escalation Path
1. Platform engineer identifies zero-day from threat intelligence feeds.
2. Immediately escalate to security team lead.
3. Joint assessment: Is the vulnerable component exposed in AI-Box containers?
4. If exposed:
   a. Apply mitigating controls (Falco rules, network restrictions, seccomp tightening).
   b. Disable affected functionality if feasible.
   c. Communicate to developers: "Feature X temporarily disabled due to active security threat."
5. When vendor patch is available: follow Critical CVE process above.

### Compensating Controls
While waiting for a patch, consider:
- Add a Falco rule to detect exploitation patterns.
- Tighten seccomp profile to block relevant syscalls.
- Add network rules to block known C2 IPs.
- Restrict the vulnerable tool pack until a fix is available.

---

## 5. False Positives and Exceptions

### Marking False Positives
Some Trivy findings may not apply (e.g., a library is present but never called in our context):
1. Document the reasoning in a CVE exception record.
2. Add to Harbor's allowlist with an expiry date (max 90 days).
3. Review all exceptions monthly.

### Exception Format
```yaml
cve: CVE-XXXX-XXXXX
package: libfoo
reason: "Package is present in base image but not invoked by any AI-Box component. Attack vector requires local admin access which is prevented by gVisor."
approved_by: security-team-lead
expires: 2026-05-21
```

---

## 6. Triage Log Template

| Date | CVE | CVSS | Affected Images | Fix Available | Action | Status |
|------|-----|------|----------------|---------------|--------|--------|
| 2026-02-21 | CVE-2026-12345 | 9.1 | base, java, full | Yes | Emergency rebuild | Complete |
| 2026-02-21 | CVE-2026-12346 | 5.3 | node | Yes | Batch weekly | Pending |
| 2026-02-21 | CVE-2026-12347 | 2.1 | dotnet | No | Monitor | Tracking |

---

## 7. Metrics

| Metric | Target |
|--------|--------|
| Daily triage completion | 100% business days |
| Critical CVE response time | < 4 hours |
| High CVE response time | < 8 hours |
| Mean time to patch (Critical) | < 8 hours |
| Mean time to patch (High) | < 24 hours |
| False positive exception count | < 10 active |

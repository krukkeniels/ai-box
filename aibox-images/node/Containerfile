# =============================================================================
# AI-Box Node.js Variant Image
# =============================================================================
# Extends the base image with Node.js 20 LTS and Yarn for JavaScript/TypeScript
# development sandboxes.
# =============================================================================

ARG BASE_REGISTRY=ghcr.io/krukkeniels/aibox
FROM ${BASE_REGISTRY}/base:24.04

LABEL maintainer="platform-team@aibox.internal" \
      version="20-24.04" \
      description="AI-Box Node.js developer sandbox (Node 20 LTS + Yarn)" \
      org.opencontainers.image.source="https://git.internal/aibox/aibox-images"

USER root

# ---------------------------------------------------------------------------
# Node.js 20 LTS (from NodeSource APT repository)
# ---------------------------------------------------------------------------
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
       gpg \
       apt-transport-https \
    && curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key \
       | gpg --dearmor -o /usr/share/keyrings/nodesource.gpg \
    && echo "deb [signed-by=/usr/share/keyrings/nodesource.gpg] https://deb.nodesource.com/node_20.x nodistro main" \
       > /etc/apt/sources.list.d/nodesource.list \
    && apt-get update \
    && apt-get install -y --no-install-recommends \
       nodejs \
    && rm -rf /var/lib/apt/lists/*

# ---------------------------------------------------------------------------
# Yarn (installed globally via npm)
# ---------------------------------------------------------------------------
RUN npm install -g yarn

# ---------------------------------------------------------------------------
# Cache directories for dependency persistence across sessions
# ---------------------------------------------------------------------------
RUN mkdir -p /home/dev/.npm /home/dev/.yarn \
    && chown -R dev:dev /home/dev/.npm /home/dev/.yarn

USER dev
WORKDIR /workspace
